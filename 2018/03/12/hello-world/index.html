




<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">

<link rel="stylesheet" href="http://assets.bjlyw.com/assets_w/css/all.css?t=2.5">


    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>

    <script type="text/javascript">
        var wxPayJson={};
        function onBridgeReady(payJson){
            wxPayJson=  $.parseJSON(payJson);
            WeixinJSBridge.invoke(
                'getBrandWCPayRequest', {
                    "appId" : wxPayJson.appId,     //公众号名称，由商户传入
                    "timeStamp": wxPayJson.timeStamp,         //时间戳，自1970年以来的秒数
                    "nonceStr" : wxPayJson.nonceStr, //随机串
                    "package" : "prepay_id=" + wxPayJson.prePayId,
                    "signType" : "MD5",   //微信签名方式:
                    "paySign" : wxPayJson.paySign  //微信签名
                },
                function(res){
                    if(res.err_msg == "get_brand_wcpay_request:ok" ) {// 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。
                        window.location.href=wxPayJson.payAlertUrl+"_1";
                    }else{
                        window.location.href=wxPayJson.payAlertUrl+"_0";
                    }
                }
            );
        }
        function fn_wx_pay(payJson){

            if (typeof WeixinJSBridge == "undefined"){
                if( document.addEventListener ){
                    document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
                }else if (document.attachEvent){
                    document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
                    document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
                }
            }else{
                onBridgeReady(payJson);
           }

        }
    </script>


<title>订单详情</title>
</head>
<body>
<header class="clearfix">
    <a class="back" href="/user/1/member/order/all/tolist"><img src="http://assets.bjlyw.com/assets_w/images/icon_back.png" alt=""></a>
    <p>订单详情</p>
</header>
<div class="order_info clearfix">
    <div class="order_info_left">
        <h3>
            
            交易成功
        </h3>
        <p>实付金额：￥0.0</p>
    </div>
    <img src="http://assets.bjlyw.com/assets_w/images/jy_success.png" alt="">
</div>
<div class="order_con">
    <a href="/trip/1/ticket/detail/0_0_910_0_0_0">北京云佛滑雪场（年卡专用链接）</a>
    <ul class="order_ul">
        <li>
            <h3>票品类型</h3>
            <p>日场成人（身高1.5米以上）</p>
        </li>
    </ul>
</div>
<div class="order_con">
    <ul class="order_ul">
        <li>
            <h3>订单号</h3>
            <p>25794434</p>
        </li>
        <li>
            <h3>下单时间</h3>
            <p>2022-02-10 21:18:10</p>
        </li>
        <li>
            <h3>支付状态</h3>
            <p>
                

                    <span>
                        已支付
                            
                            已出票
                            
                        
                        
                    </span>

            </p>
        </li>

        
            <li>
                <h3>支付方式</h3>
                <p> 
                    余额支付
                    
                </p>
            </li>
        

        
        <li>
            <h3>购买单价</h3>
            <p>￥0.0×1张</p>
        </li>
        
        
        <li>
            <h3>支付金额</h3>
            <p>￥0.0 
            </p>
        </li>





        <li>
            <h3>有效期</h3>
            2022-02-26 至 2022-02-26
            
        </li>
    </ul>
</div>

    
        <div class="order_con">
            <h2>电子兑换码</h2>
            <div class="order_con_ewm">
                <p style="line-height: 0.8rem;">可用数量：1 &nbsp; &nbsp;已消费：0&nbsp; &nbsp;已退数：0   </p>
                
                        <p style="line-height: 0.8rem;">兑换码：<font color="red"> 1645-6222-9005-5</font></p>
                    
                    
                
                

            </div>
        </div>
    


    

        


    
<div class="order_con">
    <h2>预订信息</h2>
    <ul class="order_ul">
        <li>
            <h3>姓名</h3>
            <p>曲晗东</p>
        </li>
        <li>
            <h3>手机号</h3>
            <p>17826029695</p>
        </li>
        
            <li>
                <h3>身份证</h3>
                <p>220523199502284060</p>
            </li>
        
    </ul>
</div>


<div class="order_con">
    <h2><a href="tel:010-85696688" style="color: black;"> 咨询电话：010-85696688</a></h2>
</div>








<footer class="clearfix">
    <div class="footer_btn clearfix">
        

        
            
                <a  href="javascript:;" id="refund_a_" onclick="fn_refund_show()">售后退票</a>
            
            
            
            
        
    </div>
</footer>


<div class="mask mask1" id="pay_show">
    <div class="hotel_mask_con" style="height: 6rem;">
        <h2>请选择支付方式 &nbsp;&nbsp;&nbsp;<font color="red" >金额:￥0.0</font><span>x</span></h2>
        <h2>
            <div class="header_search_fx clearfix" style="width: 100%">

                <ul class="order_ul" style="width: 100%">
                    <li style="width: 100%;">
                        <p onclick="fn_order_pay('1');" style="line-height: 1.4rem; " ><img src="http://assets.bjlyw.com/assets_w/images/wxpay.png" alt="" style="width: 3.5rem;height: 1.5rem;"  > </p>
                    </li>
                    
                    
                        <li style="width: 100%;">
                            <p onclick="fn_order_pay('2');"  style="line-height: 1.4rem;"><img src="http://assets.bjlyw.com/assets_w/images/yuepay.png" alt="" style="width: 3.5rem;height: 1.5rem;" > &nbsp;&nbsp; 账户余额：￥0 </p>
                        </li>
                    
                </ul>
            </div>
        </h2>
    </div>
</div>




    <script type="text/javascript" src="http://assets.bjlyw.com/assets_w/js/jquery-1.11.3.min.js?t=2.5"></script>
    <script type="text/javascript" src="http://assets.bjlyw.com/assets_w/js/artTemplate/3.0/template.js?t=2.5"></script>
    <script type="text/javascript" src="http://assets.bjlyw.com/assets_w/js/jquery.touchSlider.js?t=2.5"></script>
    <link rel="stylesheet" href="http://assets.bjlyw.com/assets_w/css/all.css?t=2.5">
    <script type="text/javascript" src="http://assets.bjlyw.com/assets_w/js/base.js?t=2.5"></script>





<script>
function  fn_min_open(urlTem){
    var left=  window.screen.width-250;
    var top =window.screen.height-250;
    window.open(urlTem, '二维码', 'height=250, width=250, top='+top+', left='+left+', toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no')
}



    function fn_pay(){
        $('#pay_show').show();
        $('html,body').css('overflow','hidden');
    }

    function fn_order_pay(payType){
            queryParams.curPage = 0;
            $.post('/trip/1/pay/94437_1_'+payType, queryParams, function(res){
                if(res.status == 1) {
                    if(payType=='1'){
                        fn_wx_pay(res.wxPayJson);
                        return;
                    }
                }else  if(res.status == 2) {//已支付
                    window.location.reload();//刷新
                }else {//支付失败
                    alert(res.msg);
                    window.location.reload();//刷新
                }
               // window.location.href=res.pay_alert_url;
            });
    }

    var queryParams = {};

    //票订单重新发送
    function   fn_order_again(){
        queryParams.curPage = 0;
        $.post('/user/1/member/94437/order_again', queryParams, function(res){
           // if(res.status == 1) {
            alert(res.msg);
            setTimeout(function(){},2000)
            window.location.reload()

          //  }
        });
    }


var  isItemTem='';
function  fn_refund_show(){
    $('#refund_div_').show();
    
    $('html,body').css('overflow','hidden');
}





    //订单作废
    function   fn_order_cancel(){
        queryParams.curPage = 0;
        $.post('/user/1/member/94437/order_cancel', queryParams, function(res){
            // if(res.status == 1) {
                alert(res.msg);
                window.location.reload()
            //  }
        });
    }








    function check_refund(){

       var refundNum=$("#refund_num_").val()*1;
        if(refundNum==""){
            alert("请输入退票数量！");
            $("#refund_fee_").html("0*0-0-0=0");
            return false;
        }
        var deductFee=0;
        var useNum=1;
        if(useNum*1-refundNum*1<0){
            alert("退票数量有误！");
            $("#show_refund_fee_").html("0*0-0-0=0");
            $("#refund_num_").val("0");
            return false;
        }
        return true;
    }

var rDeductFee=0;

var  isRefundSure=0;
    //获取退款金额
    function  fn_getRefundOrderFee(){
        deductFee=0;
        isRefundSure=0;
       if(!check_refund()){return;}
        var refundNum=$("#refund_num_").val();
        var  req_json= Object.assign({refundNum: refundNum});
        $.ajax({
            type:"POST",
            url:"/user/1/member/refund_order_fee/94437",
            dataType:"json",
            contentType:"application/json",
            data:JSON.stringify(req_json),
            success:function(res){
                if(res.status != 1) {
                    alert(res.message);
                    $("#refund_num_").val(0);
                    $("#refund_a_").hide();
                    $('#refund_div_').hide();
                    $('html,body').css('overflow','');
                    isRefundSure=0;
                    return;
                } else {
                    $("#show_refund_fee_").html(res.data.tRefundFee+"-"+res.data.couponFee+"(优惠券)-"+res.data.deductFee+"(手续费)="+(res.data.yRefundFee));
                    rDeductFee=res.data.deductFee;
                    isRefundSure=1;
                }
            },
            complete:function(){
                // $btn.prop("disabled", false);
            }
        });
    }


        var itemIds="";
        function  fn_refund_sure(){
            if(isRefundSure==0)return;
            itemIds="";
            
            var  req_json=Object.assign({deductFee: rDeductFee});
            var orderType='1';
            if(orderType=='1'){
                if(!check_refund()){return;}
                   req_json= Object.assign({refundNum: $("#refund_num_").val(),deductFee: rDeductFee,ids:itemIds});
            }else{
                   req_json= Object.assign({deductFee: rDeductFee});
            }

            if(rDeductFee>0){
                if(!confirm("退订手续费:￥"+rDeductFee+"，确定要退订吗？")){return;}
            }else{
                if(!confirm('你确定要退订吗？')){return;}
            }


            $.ajax({
                type:"POST",
                url:"/user/1/member/refund_order/94437/1",
                dataType:"json",
                contentType:"application/json",
                data:JSON.stringify(req_json),
                success:function(json){
                    if(json.status=='1') {
                        alert("退票申请已提交成功！");
                     // window.location.reload();
                        $("#refund_a_").hide();
                        $('#refund_div_').hide();
                        $('html,body').css('overflow','');
                    }else{
                        alert(json.message);
                    }
                },
                complete:function(){
                   //  $("#apply_button_").prop("disabled", false);
                }
            });
        }






     $(function () {


         $('.add').click(function(){
             var useNum=1;
             var refundNum=$("#refund_num_").val()*1;
             if(useNum*1-refundNum*1<=0){
             return ;
             }
             $(this).siblings('input').val(refundNum + 1);
             fn_getRefundOrderFee();
         })

         $('.min').click(function(){
             var refundNum=$("#refund_num_").val()*1;
             if(refundNum<=1){
                 return ;
             }
             $(this).siblings('input').val(refundNum - 1);
             fn_getRefundOrderFee();
         })



    });



    function  fn_checkbox(e){
        var refundNum=$("#refund_num_").val();
        if(refundNum==''){
            refundNum='0';
        }
        var idchecked = $(e).prop("checked")
        if(idchecked){
            $("#refund_num_").val(refundNum*1+1);
        }else{
            $("#refund_num_").val(refundNum*1-1);
        }
        $("#refund_num_show").val( $("#refund_num_").val());
        fn_getRefundOrderFee();

    }











</script>

<div class="mask mask1" id="refund_div_">
    <div class="hotel_mask_con" style="height: 32%" id="refund_div_show">
        <h2><b>退票申请</b><span>x</span></h2>
        <ul class="confirm_order_ul">
            
            <li>
                <h4>可退数量</h4>
                <h5></h5>
                <div class="num clearfix">
                          <input   type="text" value="1" />
                </div>
            </li>
            <li>
                <h4>退票数量</h4>
                <h5></h5>

                <div class="num clearfix"     >
                    <span class="min" >-</span>
                    <input  id="refund_num_" onblur="fn_getRefundOrderFee()" type="text" value="0" >
                    <input  id="refund_num_show" type="text" value="0" style="display:none; ">
                    <span class="add" > +</span>
                </div>
            </li>


            <li>
                <h4>退款金额</h4>
                <h5></h5>
                <div class="num clearfix" id="show_refund_fee_">
                    0*0-0-0=0
                </div>
            </li>



            <li>
                <div class="footer_btn clearfix"   style="width: 100%">
                    <a  href="javascript:;"  id="apply_button_" onclick="fn_refund_sure();">确认退票</a>
                </div>
            </li>

        </ul>
    </div>
</div>

</body>
</html>